# Lenteja JDBC

### Configuring Lenteja

```java
	final JDBCDataSource ds = new JDBCDataSource();
	ds.setUrl("jdbc:hsqldb:mem:col405");
	ds.setUser("sa");
	ds.setPassword("");
	DataAccesFacade facade = new JdbcDataAccesFacade(ds);
```

The `DataAccesFacade` allows to perform the following operations:


```java
	<T> T loadUnique(IQueryObject q, Mapable<T> mapable) throws TooManyResultsException, EmptyResultException;
	<T> T loadFirst(IQueryObject q, Mapable<T> mapable) throws EmptyResultException;
	<T> List<T> load(IQueryObject q, Mapable<T> mapable);
	int update(IQueryObject q);
	<T> T extract(IQueryObject q, Mapable<T> extractor);
	void begin();
	void commit();
	void rollback();
```

### A Lenteja full example

```java
public class LentejaTest {

	final DataAccesFacade facade;

	public LentejaTest() {
		final JDBCDataSource ds = new JDBCDataSource();
		ds.setUrl("jdbc:hsqldb:mem:pizza");
		ds.setUser("sa");
		ds.setPassword("");
		this.facade = new JdbcDataAccesFacade(ds);
	}

	@Before
	public void before() {
		facade.begin();
		try {
			facade.update(new QueryObject("drop table pizzas if exists;"));
			facade.update(new QueryObject(
					"create table pizzas (id_pizza integer primary key generated by default as identity(start with 10), name varchar(15) not null, price numeric(15,2) not null);"));
			facade.commit();
		} catch (Throwable e) {
			facade.rollback();
			throw e;
		}
	}

	public static class Pizza {

		public Long idPizza;
		public String name;
		public Double price;

		@Override
		public String toString() {
			return "Pizza [idPizza=" + idPizza + ", name=" + name + ", price=" + price + "]";
		}
	}

	@Test
	public void testName() throws Exception {

		facade.begin();
		try {

			Pizza napolitana = new Pizza();
			napolitana.name = "napolitana";
			napolitana.price = 10.25;

			assertEquals("Pizza [idPizza=null, name=napolitana, price=10.25]", napolitana.toString());

			QueryObject q = new QueryObject();
			q.append("INSERT INTO pizzas (name, price) VALUES (?,?)");
			q.addArg(napolitana.name);
			q.addArg(napolitana.price);
			facade.update(q);

			napolitana.idPizza = facade.loadUnique(new QueryObject("call identity()"), (rs) -> rs.getLong(1));
			assertEquals("Pizza [idPizza=10, name=napolitana, price=10.25]", napolitana.toString());

			List<Pizza> allPizzas = facade.load(new QueryObject("SELECT * FROM pizzas"), (rs) -> {
				Pizza p = new Pizza();
				p.idPizza = rs.getLong("id_pizza");
				p.name = rs.getString("name");
				p.price = rs.getDouble("price");
				return p;
			});

			assertEquals("[Pizza [idPizza=10, name=napolitana, price=10.25]]", allPizzas.toString());

			facade.commit();
		} catch (Exception e) {
			facade.rollback();
			throw e;
		}
	}
}

```

### Lenteja SQL script runner

```java
	facade.begin();
	try {
		SqlScriptExecutor sql = new SqlScriptExecutor(facade);
		sql.runFromClasspath("pizza_exps.sql");
		facade.commit();
	} catch (Throwable e) {
		facade.rollback();
		throw e;
	}
```


### Lenteja Transactional dynamic proxy
